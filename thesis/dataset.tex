% pamiętać, żeby opisać wszystkie kroki, wszystkie SKRYPTY (koncepcję i algorytmy spisać szczegółowo,
% szczegóły techniczne, jak co zwraca, co przyjmuje dana funkcja pominąć), zerknąć na COMMITY !!!
\chapter{Zbiór danych}

\section{Wstęp}

% potrzeba danych!
Pierwszym i jednocześnie najważniejszym etapem w tworzeniu rozwiązania opartego o uczenie maszynowe
jest zgromadzenie odpowiedniego zbioru danych. Jest to etap kluczowy, co wydaje się oczywiste po
uwzględnieniu natury tychże algorytmów - wynajdują one pewne reguły w oparciu o podane przykłady.

% potrzeba danych oznaczonych (jak zawsze) i nieoznaczonych (bo pomogą a są)
Głęboki sieci neuronowe, co do zasady potrzebują ,,dużo'' (zazwyczaj wiele milionów) przykładów
uczących, aby móc znaleźć poprawne reguły i wzorce - aby nauczyć się odpowiedniej ekstrakcji cech. W
celu wytrenowania sieci do konkretnego zadania (np. do klasyfikacji obrazów), potrzeba zbioru
zawierającego dane wejściowe do modelu i oczekiwane dane wyjściowe z modelu. Takie uczeni w oparciu
o przykłady oznaczone (ze znaną wartością oczekiwaną) to \emph{uczenie nadzorowane}. Często jednak
ilość danych oznaczonych jest ograniczona, można wtedy wykorzystać dane bez oznaczeń w różnych
algorytmach \emph{uczenia nienadzorowanego}, aby nauczyć sieć struktury tych danych, bez
ukierunkowania na konkretne zadanie. Dopiero później wykorzystuje się mniejszą ilość danych
oznaczonych aby dotrenować sieć (\emph{finetuning}) i nauczyć ją rozwiązywać dany problem.

% co zawiera ten rozdział - od szukania danych do wejścia do sieci + opis skryptów
W ramach niniejszej pracy, ze względu na ograniczoną ilość danych oznaczonych, zastosowane zostało
właśnie powyższe podejście. Do przeprowadzenia eksperymentów potrzebne były dwa zbiory: pierwszy to
,,niewielki'' zbiór danych oznaczonych a drugi to ,,zdecydowanie większy'' zbiór danych bez
oznaczeń. W tym rodzdziale opisany został proces pozyskiwania obu zbiorów danych z ogólnie
dostępnych źródeł. Zawarto tutaj opis wszystkich kroków wykonanych w celu przygotowania danych do
treningu sieci, poczynając od wyszukiwania oznaczeń utworów muzycznych i przygotowanie parsera dla
plików z tymi oznaczeniami, poprzez automatyczne wyszukiwania i pobieranie odpowiednich plików z
nagraniami muzycznymi, aż po wstępne przetwarzanie danych do formatu odpowiedniego dla sieci
neuronowej. Dodatkowo rozdział ten, poza opisem zastosowanych rozwiązań, zawiera również ogólny opis
implementacji tychże rozwiązań, którą to implementację stanowią skrypty języka Python.


\section{Dane oznaczone}

% trudno o dane oznaczone w ACR
Ze względu na powszechną dostępność dużej ilości danych w Internecie, zgromadzenie zbioru danych
nieoznaczonych nie stanowiło szczególnego problemu. Znacznie trudniejsze okazało się zgromadzenie
zbioru danych oznaczonych. Zadanie rozpoznawania akordów muzycznych, mimo iż będące jednym z
głównych zadań z dziedziny \emph{MIR}, jest oczywiście bardzo mało popularne w stosunku do takich
zadań jak klasyfikacja, czy segmentacja obrazów. Jest to również po prostu znacznie mniej przydatne
w życiu codziennym i znacznie mniej się w tę dziedzinę inwestuje. Należy również uwzględnić fakt, że
przygotowanie oznaczeń akordów do utworów muzycznych wymaga specjalistycznej wiedzy muzycznej,
praktyki muzycznej i dużo czasu. Oznaczenia powstałe w ten sposób nadal pozostają subiektywne i będą
się często różnić, w zależności od osoby, która utwory oznaczała. Wszystkie wymienione powody są
przyczyną tego, że nie przygotowano więcej niż kilka publicznie dostępnych zbiorów oznaczeń akordów
muzycznych, które mogą zostać wykorzystane do treningu modeli uczenia maszynowego.


% od początku do uzyskania wszystkich oznaczeń ('data/chordlab') oraz pierwszego indeksu (skrypt 01)
\subsection{Publiczne zbiory z oznaczeniami akordów}

% zbiory są takie, co to inni wykorzystywali
W ramach niniejszej pracy przestudiowana została literatura z dziedziny rozpoznawania akordów za
pomocą sieci neuronowych - większość wykorzystywanych przez badaczy zbiorów danych udało się
odnaleźć i wykorzystać. Zostały one szczegółowo opisane poniżej. Każdy zbiór oznaczeń został
pobrany, odpowiednio oczyszczony (wybrane zostały tylko niezbędne pliki) i zapisany w repozytorium
projektu (w katalogu ,,data/chordlab''. Po przeanalizowanu struktury zbiorów stworzony został pierwszy skrypt przygotowujący dane
- ,,src/dataset\_scripts/01-generate\_index\_of\_chordlab.py'' - który, w postaci pliku \emph{csv},
generuje jeden wspólny indeks (,,data/index.csv'') dla wszystkich zbiorów, tak że mogą one być już traktowane jako jeden
zbiór danych. Fragment tego indeksu został przedstawionyw w \ref{tab:indeks_01}.

\begin{table}
    \caption{Fragment indeksu zbioru danych po pierwszym etapie jego tworzenia}
    \label{tab:indeks_01}
    \begin{tabular}{rllllr}
    \hline
    & filepath & song & artist & subset & album \\
    \hline
     0 & ./data/chordlab/rs200/1999\_dt.clt                      & 1999                      & Prince                      & rs200 & nan \\ 
     1 & ./data/chordlab/rs200/a\_change\_is\_gonna\_come\_dt.clt    & A Change Is Gonna Come    & Sam Cooke                   & rs200 & nan \\
     5 & ./data/chordlab/rs200/all\_along\_the\_watchtower\_dt.clt  & All Along the Watchtower  & The Jimi Hendrix Experience & rs200 & nan \\
     6 & ./data/chordlab/rs200/all\_apologies\_dt.clt             & All Apologies             & Nirvana                     & rs200 & nan \\
     7 & ./data/chordlab/rs200/all\_i\_have\_to\_do\_is\_dream\_dt.clt & All I Have to Do Is Dream & The Everly Brothers         & rs200 & nan \\
    \hline
    \end{tabular}
\end{table}

Trzeba jeszcze zaznaczyć, że wszystkie te zbiory są udostępniane za darmo, ale jedynie jako same
pliki tekstowe z oznaczeniami akordów. Pliki z nagranimi muzycznymi, ze względu na prawa autorskie,
nie są udostępniane. Pozyskanie odpowiednich nagrań stanowi osobny problem, opisany w dalszej części
rozdziału.

\subsubsection{Zbiór Isophonics}

% ogólny opis, jakie i ile utworów, format zapisu
\emph{Isophonics} to właściwie nazwa serwisu internetowego\footnote{www.isophonics.net/about},
prowadzonego przez zespół naukowy \emph{Centre for Digital Music} z londyńskiego Uniwersytety
Królowej Marii. Jest to duża i popularna na cały świat jednostka naukowa specjalizująca się w
badaniach dotyczących przetwarzania muzyki cyfrowej. W serwisie tym dostępne są między innymi
oprogramowanie oraz zbiory danych związane z różnymi aspektami przetwarzania sygnałów muzycznych.
Można tam znaleźć najbardziej popularny i zapewne najstarszy zbiór z oznaczeniami akordów
muzycznych, przygotowany dla 180 piosenek zespołu \emph{The Beatles}, szczegółowo opisany w
\cite{harte_towards_nodate}. Zbiór ten rozrósł się o oznaczenia dla 20 utworów \emph{Queen}, 18
utowrów \emph{Zweieck} i 7 utworów \emph{Carole King}. Wykorzystany format zapisu oznaczeń akordów
również jest opisany w \cite{harte_towards_nodate} i jest wykorzystywany praktycznie jako standard,
również w przypadku innych zbiorów danych. Warto wspomnieć jeszcze, że jest to pierwszy referencyjny
zbiór wykorzystywany w konkursie MIREX, w zadaniu automatycznego rozpoznawania akordów.

% pobieranie i indeksowanie
Zbiór \emph{Isohponics} jest dostępny do pobrania ze strony projektu w postaci skompresowanych
archiwów \emph{tar} (osobny plik dla każdego z czterech artystów). Każde z tych archiwów ma taką
samą strukturę i zawiera nie tylko oznaczenia akordów, dostępne w różnych formatach, ale również
inne informacje o utworach, jak zmiany tonacji czy segmentacje strukturalne. Spośród wszystkich tych
plików wykorzystane zostały jedynie oznaczenia akordów w postaci plików \emph{lab} - pozostałe pliki
zostały usunięte. Pliki z oznaczeniami akordów uporządkowane są w takiej stukturze katalogów, gdzie
nazwy katalogów na kolejnych poziomach zagłębienia odpowiadają kolejno nazwie artysty, nazwie albumu
(dla The Beatles poprzedzonej dodatkowo liczbą porządkową) i numerowi wraz z nazwą konkretnego
utworu. Zbiór ten nie posiada żadnego dodatkowego indeksu, przy tworzeniu własnego indeksu zostały
więc wykorzystane nazwy katalogów.

% poprawki i zapisanie w projekcie
Jedyne zmiany, jakie zostały wprowadzone w oznaczeniach akordów po pobraniu ich z Internetu, poza
usunięciem niewykorzystywanych plików, dotyczą artystki Carole King. Polegały one na dostosowaniu
kilku skrótów typów akordów, które występowały jedynie tutaj a były niezgodne z przyjętą w
\cite{harte_towards_nodate} konwencją.  Wszystkie oznaczenia zbioru \emph{isohponics}, po
przeprowadzeniu opisanych powyżej operacji, zostały zapisane w repozytorium projektu, w katalogu
,,data/chordlab/isophonics''.


\subsubsection{Zbiór McGill Billboard}

% ogólny opis, jakie i ile utworów, format zapisu
Zbiór \emph{McGill Billboard} \cite{burgoyne_expert_2011} został stworzony przez grupę \emph{DDMAL
(Distributed Digital Music Archives \& Libraries Lab)}\footnote{https://ddmal.music.mcgill.ca/} z
kandadyjskiego \emph{McGill University}. Jak nazwa wskazuje, zajmują się oni różnymi projektami
związanymi z przetwarzaniem muzyki, w tym tworzą i utrzymują ten prawdopodobnie największy, dostępny
publicznie zbiór danych z różnymi typami oznaczeń utworów, takimi jak akordy, struktura, instrumenty
i tempo. Lista utworów wybranych do tego zbioru została zbudowana z 1300 utworów, losowo
próbkowanych z rankingów serwisu \emph{Billboard}\footnote{www.billboard.com}. W praktyce, ponieważ
niektórych utworów nie udało się twórcom znaleźć, zbiór ten zawiera 890 utworów muzyki popularnej,
przy czym zdarzają się takie, które się powtarzają. Oznaczenia akordów są wyrównane w czasie zgodnie
z częstotliwością występowania taktów. Format tych oznaczeń bazuje ściśle na
\cite{harte_towards_nodate} (tak jak \emph{isophonics}), jedyna różnica polega na wprowadzeniu kilku
dodatkowych skrótów typów akordów.  Podobnie jak w przypadku innych zbiorów z oznaczeniami akordów,
twórcy tego zbioru nie mogli udostępnić nagrań muzycznych. Jednakże w tym przypadku udostępnione
zostały dwa zestawy cech dla wszystkich akordów: \emph{non-negative-least-squares chroma vectors}
oraz \emph{Echo Nest features}, które mogą zostać wykorzystane jako wejście do modeli ML, nie były
jednak użyte w ramach niniejszej pracy.

% pobieranie i indeksowanie
Zbiór \emph{McGill Billboard} dostępny jest do
pobrania\footnote{https://ddmal.music.mcgill.ca/research/The\_McGill\_Billboard\_Project\_(Chord\_Analysis\_Dataset)/}
w postaci skompresowanych (na kilka sposobów) archiwów \emph{tar}. Dostępne są pliki ze wspomnianymi
powyżej dwoma zestawami dźwiękowych cech utworów, dostępny jest zestaw wszystkich oznaczeń we
własnym formacie twórców zbioru, oraz zestaw oznaczeń samych akordów, w postaci plików \emph{lab}.
Do niniejszej wykorzystany został jedynie ten ostatni zestaw, zawierający pliki \emph{lab}. Pobrane
archiwum zawiera główny katalog ,,McGill-Billboard'', w którym znajduje się 890 katalogów nazwanych
liczbowymi identyfikatorami utworów ze zbioru. Każdy taki katalog zawiera jeden plik ,,full.lab'' z
oznaczeniami akordów. Twórcy zbioru dostarczają również indeks w postaci pliku \emph{csv}, wiążący
identyfikatory utworów z tytułem, artystą (album nie jest podany) i innymi informacjami związanymi z
rankingiem, z którego pochodzi utwór. Indeks ten jest niestety bardzo wybrakowany i dla wielu
utworów brakuje wpisu o tytule lub artyście. Po wybraniu tych przypadków, dla których znany jest
tytuł i artysta zostało jedynie 596 utworów. Tabela ta została wykorzystana do przygotowanie
własnego indeksu.

% poprawki i zapisanie w projekcie
Pobrane oznaczenia akordów nie wymagały właściwie żadnych poprawek. Cały katalog
,,McGill-Billboard'' został przeniesiony do repozytorium projetu, do katalogu
,,data/chordlab/mcgill\_billboard''.

\subsubsection{Zbiór Robbie Williams}

% ogólny opis, jakie i ile utworów, format zapisu
Zbiór \emph{Robbie Williams} \cite{giorgi_automatic_2013} składa się z oznaczeń akordów oraz tonacji
dla pierwszych pięciu albumów Robbiego Williamsa. Został przygotowany przez włoskich naukowców z
Politechniki w Mediolanie na potrzeby uczenia systemu automatycznego rozpoznawania akordów.
Oznaczenia są zgodne z \cite{harte_towards_nodate}. W sumie dokładne oznaczenia akordów i tonacji
przygotowano dla 65 utworów.

% pobieranie i indeksowanie
Zbiór ten dostępny jest do pobrania ze strony
\footnote{https://www.researchgate.net/publication/260399240_Chord_and_Harmony_annotations_of_the_first_five_albums_by_Robbie_Williams}
w postaci archiwum zip. Znajduje się w nim katalog \emph{RobbieWilliamsAnnotations}, który zawiera
dwa główne podkatalogi: \emph{chords} i \emph{keys}. W każdym z tych podkatalogów znajduje się po pięć
podkatalogów (po jednym na album). W każdym katalogu z albumem znajdują się pliki \emph{txt} z
oznaczeniami akordów w formacie \emph{lab}. Zbiór ten nie posiada żadnych dodatkowych metadanych,
własny indeks wygenerowany został na podstawie znormalizowanych nazw katalogów.

% poprawki i zapisanie w projekcie
Pobrane oznaczenia znowu nie wymagały żadnych poprawek. Zawartość katalog
,,RobbieWilliamsAnnotations/chords/'' została przeniesiona do repozytorium projektu, do katalogu
,,data/chordlab/robbie\_williams''.

\subsubsection{Zbiór RS200}

% ogólny opis, jakie i ile utworów, format zapisu
Zbiór \emph{RS200} \cite{de_clercq_corpus_2011} został stworzony przez dwóch badaczy z amerykańskiej
uczelni muzycznej \emph{Eastman School of Music} w Rochester. Powstał on na bazie listy \emph{500
Greatest Songs of All Time} z magazynu \emph{Rolling Stone}. Początkowo zawierał jedynie 100 utworów i w
takiej formie zostały wykorzystany w oryginalnej publikacji, gdzie autorzy analizowali częstość
występowania różnych akordów i ich progresji. Utwory te zostały wybrane tak, aby pochodziły z wielu
różnych dekad. Z czasem zbiór został rozszerzony do 200 utworów i w takiej formie jest dostępny do
dzisiaj. Każdy z dwóch twórców, niezależnie od drugiego, przygotował swoje oznaczenia dla wszystkich
200 utworów. Oznaczenia te zawierają nie tylko akordy, ale również transkrypcję melodii, informacje
o tempie i tekstach utworów. Format zapisu oznaczeń akordów został opracowanych przez twórców tego
zbioru danych i różni się zdecydowanie od sposobu oznaczeń stosowanego w pozostałych zbiorach.
Bardziej szczegółowo został opisany w dalszej części rozdziału, ale ogólnie opiera się on na
rekurencyjnej składni, pozwalającej łatwo reprezentować pewne schematy i powtórzenia w strukturze
utworów. Same oznaczenia akordów są również ustalone przez tych autorów i bazują na liczbach
rzymskich, które prezentują informacje względem klucza tonacji całego utworu. Mamy więc tutaj do
czynienia z podejściem zupełnie innym, od przyjętego dla pozostałych zbiorów danych.

% pobieranie i indeksowanie
Zbiór ten dostępny jest do pobrania ze strony
\footnote{http://rockcorpus.midside.com/harmonic_analyses.html}. Właściwie autorzy oferują trzy
formaty, z których ostatni jest już rozwinięty do postaci zbliżonej do plików \emph{lab}. Główna
różnica to wspomniany powyżej sposób oznaczania konkretnych akordów. Po pobraniu i rozpakowaniu archiwum
\emph{zip} znaleźć można pojedynczy katalog ,,rs200_harmony_clt'', który zawiera pliki z
rozszerzeniem \emph{clt}, po dwa dla każdego utworu, jeden z suffiksem ,,dt' a drugi ,,tdc'' (od
nazwisk autorów). Ze względu na to, że oznaczenia jednego z autorów były znacznie bardziej
uporządkowane i prostsze a kwestia różnić w oznaczeniach dwóch różnych osób nie jest szczególnie
związana z tematem niniejszej pracy, wybrane zostały jedynie oznaczenia z sufikem ,,dt''. Jeżeli
chodzi o indeksowanie plików z oznaczeniami, to autorzy dostarczają plik \emph{txt} z opisem
wszystkich plików z oznaczeniami, w tym z tytułem utworu, rokiem wydania i nazwiskiem artysty. Plik
ten, po wprowadzeniu kilku niezbędnych poprawek (literówki i pomyłki w nazwach, odniesienia do
nieistniejących plików), został wykorzystany do generowania głównego indeksu utworów.

% poprawki i zapisanie w projekcie
Wybrane pliki z suffiksem ,,dt'' nie wymagały już więcej poprawek. Zostały wzsystkie, przeniesione
do katalogu ,,data/chordlab/rs200''.

\subsubsection{Zbiór RWC POP}

% ogólny opis, jakie i ile utworów, format zapis
Zbiór RWC POP \cite{goto_rwc_nodate} stanowi część większego zbioru o nazwie RWC (Real World
Computing) Music Database\footnote{https://staff.aist.go.jp/m.goto/RWC-MDB/}, stworzonego przez Real
World Computing Partnership (RWCP) w Japonii. Jest to oczyszczony z praw autorskich, dostępny za
darmo (trzeba pokryć jedynie koszty kopiowania i dostawy) wielkoskalowy zbiór 315 utworów
muzycznych, podzielonych na 5 zestawów o różnym zastosowaniu, jak rozpoznawanie gatunku czy
instrumentu muzycznego. Jednym z tych zestawów jest właśnie Popular Music Database zawierający 100
utworów muzyki popularnej - 20 w stylu popularnej muzyki zachodniej z lat 80-tych (w języku
angielskim) i 80 w stylu popularnej muzyki japońskiej, z lat 90-tych (w języku japońskim). Właściwie
zbiór ten, poza potencjalną możliwością uzyskania darmowego i legalnego dostępu do nagrań
dźwiękowych, nie jest przydatny dla zadania rozpoznawania akordów, ponieważ nie zawiera oznaczeń
akordów. Te zostały jednak przygotowane dla wszystkich 100 utworów przez studentów uniwersytetu w
Nowym Jorku z Music and Audio Research Lab. Format tych oznaczeń jest ponownie zgodny z
\cite{harte_towards_nodate}. W praktyce, w ramach niniejszej pracy wykorzystane zostały tylke te
oznaczenia. Dla uproszczenia i zautomatyzowania całego procesu przygotowania danych nagrania
muzyczne próbowano pozyskać tą samą metodą jak w przypadku pozostałych zbiorów danych.

% pobieranie i indeksowanie
Oznaczenia akordów do zbioru RWC POP są dostępne za darmo do pobrania w Internecie jako repozytorium
git w serwisie GitHub\footnote{https://github.com/tmc323/Chord-Annotations}. Bezpośrednio w
repozytorium znajduje się katalog ,,RWC_Pop_Chords'', który zawiera pliki z oznaczeniami
akordów w dwóch formatach: \emph{svl} oraz \emph{lab}.

\subsubsection{Zbiór Uspop}
todo





% annotation parser i implementacja CSR
\subsection{Parsowanie plików z oznaczeniami akordów}
todo




% skrypt evaluation, downloading, 02 i 03 - znalezienie najlepiej pasujących nagrań muzycznych
\subsection{Pozyskanie plików z nagraniami muzycznymi pasującymi do oznaczeń}

% to jest problem generalnie
Znalezienie odpowiednich plików z nagraniami muzycznymi stanowiło jeden z głównych problemów,
rozwiązywanych w ramach niniejszej pracy. Jest to problem z którym mierzyli się również twórcy
poprzednich rozwiązań, ponieważ tak jak wspomniano wcześniej, nieliczne zbiory danych oznaczeń
akordów dostarczane są zazwyczaj bez utworów muzycznych, ze względu na prawa autorskie muzyków
(wyjątkiem jest oczyszczony z praw autorskich zbiór RWC POP).

% nie można tak po prostu łatwo ich wyszukać - opis i ocena ręcznej procedury
\subsubsection{Analiza koncepcji ręcznego wyszukiwanie nagrań}
Pierwszym i prawdopodobnie prowadzącym do najmniejszej liczby pomyłek sposobem pozyskania utworów
muzycznych jest szukanie ,,ręczne''. Polegało by ono na znalezieniu odpowiednich artystów, albumów i
konkretnych nagrań w serwisach muzycznych i innych ogólnie dostępnych źródłach, lub też w razie
potrzeby zakupienie odpowiednich nagrań. Każdy zbiór oznaczeń należałoby rozpatrzeć osobno i w miarę
możliwości spróbować pozyskać oryginalne, wykorzystane podczas tworzenia oznaczeń nagrania. W
przypadku zbioru RWC POP nagrania są możliwe do pozyskania za symboliczną opłatą. W przypadku
zbiorów Isohponics, Robbie Williams i uspop wiadomo (w miarę) dokładnie o które nagrania chodzi
ponieważ dla każdego utworu znana jest nazwa albumu. Można próbować dostać się do tych konkretnych
albumów, weryfikując wyrywkowo, czy oznaczenia pasują do nagrań - możliwe jest jednak, że trafi się
na jakieś poprawione wydania, gdzie wszystkie utwory będą np. przesunięte w czasie. Można wtedy
próbować je ,,naprawić'' za pomocą odpowiedniego programu komputerowego. Co do pozostałych zbiorów,
to nie jest znany album i w tym przypadku zdecydowanie już nie można łatwo stwierdzić, które spośród
wielu możliwych nagrań będzie pasowało do oznaczeń. Trzeba by więc samodzielnie odsłuchać fragment
każdej znalezionej wersji nagrania i znaleźć tą odpowiednią, w najgorszym przypadku odrzucając
wszystkie i pozostając z samymi oznaczeniami akordów. Tak więc metoda ta, chociaż najdokładniejsza,
jest niezwykle czasochłonna i trudno skalowalna w przypadku znalezienia większej liczby oznaczeń.
Co więcej i tak nie daje ona pewności, że nie trafią się nagrania niepasujące, chyba że ostatecznie
każde wybrane nagrania zostanie przesłuchane i porównane z oznaczeniami akordów. Na końcu warto
wspomnieć, że cały opis powyższej procedury ,,ręcznej'', choć przemyślany, jest jedynie teoretyczny
(nie był zrealizowany od początku do końca) i nie wiadomo, jakie problemy okazałyby się mało
znaczące, a jakie nie zostały wzięte pod uwagę.

% motywacja i decyzja o procedurze automatycznej
\subsubsection{Motywacja i decyzja o automatycznym wyszukiwaniu nagrań}
W ramach niniejszej pracy zdecydowano się na automatyczną procedurę wyszukiwania odpowiednich
utworów muzycznych w serwisie YouTube Music\footnote{music.youtube.com}. Takie podejście prowadzi
prawdopodobnie do pozyskania większej ilości niepasujących nagrań i co ważniejsze, w ogóle do
pozyskania mniejszej ilości nagrań. Jest to jednak podejście zdecydowanie szybsze i znacznie
bardziej inżynierskie. Automatyzacja procesu wyszukiwania odpowiednich nagrań sama w sobie stanowi
ciekawy problem, ktorego możliwe rozwiązania wydają się być cenne, ze względu na swoją szybkość,
powtarzalność i skalowalność. Z tych powodów zdecydowano się, że ostatecznie zbiór danych
oznaczonych będzie prawdopodobnie trochę mniejszy i bardziej zanieczyszczony, niż w przypadku
ręcznego wyszukiwania odpowiednich utworów. Poświęcono natomiast czas na przygotowanie
nieskomplikowango algorytmu, opierającego się na kilku prostych założeniach, pozwalającego
automatycznie wyszukiwać odpowiednie nagrania w serwisie YouTube Music. Algorytm ten można opisać w
kilku prostych krokach.  Składają się na nie jednak trzy bardziej złożone operację: wyszukiwanie
utworu w serwisie YouTube Music, pobieranie konkretnego nagrania na dysk lokalny oraz ewaluacja tego
nagrania - oceny na ile jest ono zgodne z dostępnymi oznaczeniami akordów. Wszystkie trzy operacje
są szczegółowo opisane poniżej.

% opis wyszukiwania utworów i liba ytmusicapi
\subsubsection{Wyszukiwanie utworów w serwisie YouTube Music}
Wyszukiwanie utworów w serwisie YouTube Music zostało wykonane za pomocą nieoficjalnego klienta
pythonowego do tego serwisu - \emph{ytmusicapi}\footnote{https://github.com/sigma67/ytmusicapi}.
Daje on mniej więcej takie same możliwości jak korzystanie z oficjalnego, graficznego klienta
przeglądarkowego. Można jednak wszystkie operacje łatwo zautomatyzować. Jest to przykład tak zwanego
\emph{web scrappingu}, który w tym przypadku jest niezbędny, jako że oficjalne API do tego serwisu
nie istnieje, a dostępne w ograniczonym zakresie (ograniczona liczba zapytań) API do całego serwisu
YouTube nie daje wystarczających możliwości przeszukiwania dostępnych tam nagrań muzycznych.
Korzystanie z klienta \emph{ytmusicapi} jest niezwykle proste. Trzeba jedynie stworzyć
instancję obiektu \emph{YTMusic} (jest to dostęp analogiczny jak dla niezalogawnego użytkownika w
przeglądarce) i wywołać metodę \emph{search} przyjmującą tekstowe zapytanie (takie jak wpisywane w
pole wyszukiwania w kliencie graficznym) i filtr, ograniczający wyniki do danego typu treści, np.
tylko do nagrań muzycznych, lub tylko do filmów. W zwróconych wynikach dostępne są informacje o
indentyfikatorze zasobu (\emph{video\_id}), tytule utworu, artyście (lub artystach) i albumie
(opcjonalnie).

% opis pobierania utworów - skryptu i liba pytube
\subsubsection{Pobieranie nagrań z serwisu YouTube na dysk lokalny}
Pobieranie nagrań na dysk lokalny również jest zrealizowane za pomocą nieoficjalnego, pythonowego
klienta, tym razem już do całego serwisu YouTube -
\emph{pytube}\footnote{https://github.com/pytube/pytube}. Służy on właściwie nie tyle do
przeszukiwania serwisu YouTube co do pobieranie z niego całych filmów lub samych ścieżek dźwiękowych
w dostępnych formatach i jakościach. Aby z niego skorzystać trzeba stworzyć instancję klasy
\emph{YouTube} podając jako argument adres URL konkretnego filmu, przy czym wystarczy oczywiście
znać jedynie jego \emph{video\_id} (,,http://youtube.com/watch?v=\emph{video\_id}''). Następnie
można filtrować dostępne formaty i ostatecznie pobrać wybrany strumień na dysk. Przygotowana została
funkcja pomocnicza (,,src/dataset\_scripts/downloading.py''), która dla danego \emph{video\_id},
jeżeli nagranie nie zostało już pobrane (nie istnieje plik we wskazanym katalogu), wybiera pośród
dostępnych strumieni z samym dźwiękiem ten w najlepszej jakości i zapisuje go jako plik dźwiękowy do
wskazego katalogu. Pobieranie to może się z różnych powodów nie powieść (błąd sieci, YouTube odrzuca
podejrzane żądanie, etc.).

% opis idei ewaluacji nagrań i liba madmom
\subsubsection{Ewaluacja nagrań - ocena dopasowania do oznaczeń akordów}
Ewaluacja nagrań jest najbardziej skomplikowaną i jednocześnie najważniejszą częścią całego procesu
wyszukiwania nagrań. Aby automatycznie ocenić czy nagranie pasuje do oznaczeń trzeba automatycznie
rozpoznać jakie akordy w nim występują. Z kolei przygotowanie algorytmu rozpoznającego akordy
stanowi jeden z podstawowych celów niniejszej pracy. Oczywiście nie można się więc na tym etapie
posłużyć własnym rozwiązaniem. Istnieje natomiast dużo gotowych, wysokopoziomowych bibliotek, które
realizują to zadanie, z większą bądź mniejszą dokładnością. Wysoka dokładność takiego algorytmu nie
ma na tym etapie dużego znaczenia, chodzi jedynie aby poglądowo ocenić, czy dane nagranie pasuje do
oznaczeń, czy może jest to zupełnie inny utwór, czy jedynie inna, wolniejsza lub trochę przesunięta
w czasie wersja oryginalnego nagrania. Zdecydowano się na użycie biblioteki
\emph{madmom}\footnote{https://github.com/CPJKU/madmom}, której autorem jest sam Korzeniowski.
Biblioteka ta, podobnie jak dwie poprzednie i w ogóle zdecydowana większość bibliotek języka Python,
jest bardzo prosta w użyciu. Trzeba wybrać odpowiedni algorytm, stworzyć jego instancję i wywołać
przekazując ścieżkę do pliku. Pod spodem wykorzystywana jest biblioteka \emph{ffmpeg} do odczytania
praktycznie dowolnego formatu, za pomocą wytrenowanego wcześniej modelu rozpoznawane są występujące
akordy (standardowe 25 klas) i zwracane są czasy ich występowania i symbole w formacie
wykorzystywanym w plikach \emph{lab} (zgodnym z \cite{harte_towards_nodate}). Ze względu na
niewielkie wymagania dotyczące jakości klasyfikacji i większe wymagania dotyczące szybkości
działania, zdecydowano się użyć prostszego z dwóch dostępnych algorytmów, czyli \emph{Deep Chroma
Extractor} \cite{korzeniowski_feature_2016}.

% dokładny opis procedury ewaluacji (skryptu ewaluacyjnego)
Cała procedura ewaluacji nie kończy się na wywołaniu biblioteki i rozpoznaniu występujących akordów.
Trzeba wybrać odpowiednie metryki pozwalające łatwo porównać między sobą kilka dostępnych nagrań dla
danego zestawu oznaczeń akordów. Po pierwsze wykorzystana została podstawowa miara WCSR. Po drugie
dla każdego nagrania liczone jest przesunięcie czasowe pomiędzy początkiem pierwszego oczekiwanego
(z pliku z oznaczeniami) i pierwszego rozpoznanego (za pomocą biblioteki madmom) akordu
(\emph{start\_diff}), oraz przesunięcie czasowe pomiędzy końcem ostatniego oczekiwanego i ostatniego
rozpoznanego akordu (\emph{stop\_diff}). Oczywiście poprzez wystąpienie akordu rozumie się
wystąpienie akordu dowolnej klasy poza \emph{no chord}. Realizujące wszystkie te operacje funkcja
pomocnicza znajduje się w pliku ,,src/dataset\_scripts/evaluation.py''. W przypadku gdy żaden akord
nie występuje w oznaczeniach lub nie został rozpoznany funkcja ta nie zwraca żadnych wartości.

% interpretacja metryk
Metryka WCSR pozwala ocenić na ile znalezione akordy są zgodne z oczekiwanymi. Metryki prezentujące
przesunięcie czasowe dodatkowo pozwalają wykryć sytuację, kiedy znalezione nagranie zaczyna się w
innym momencie albo ma zupełnie różną długość. W obu tych sytuacjach wciąż możliwa jest względnie
wysoka wartość miary CSR, która nie pozwala łatwo wyeliminować nagrań, ktore z powodu różnej
długości z całą pewnością nie pasują do oznaczeń.

\subsubsection{Algorytm automatycznego wyszukiwania pasujących nagrań muzycznych}

Poniższe kroki są wykonywane dla każdej pozycji z indeksu (,,data/index.csv'') opisującego cały
dostępny zbiór oznaczeń. Przechodzenie przez cały indeks dzieje się równolegle w 16 procesach, jako
że w zastosowanym algorytmie nie ma żadnych zależności między poszczególnymi utworami. Wynikiem
działania algorytmu są dodatkowe kolumny w pliku ,,index.csv'', prezentujące identyfikator
najlepszego znalezionego nagrania (\emph{video\_id}) oraz wyniki ewaluacji tego nagrania:
przesunięcie początku pierwszego akordu (\emph{start\_diff}) i zakończenia ostatniego
(\emph{stop\_diff}) względem pliku z oznaczeniami oraz wartość miary CSR (\emph{csr}).

Poniższy algorytm jest dodatkowo przygotowany w taki sposób, aby móc wykonywać go wielokrotnie dla
tego samego indeksu w celu wyszukiwania nagrań dla nowo dodanych plików z oznaczeniami, skorzystania
z dostępnych od niedawna nagrań lub po prostu kontynuacji przerwanego działania, które jest
czasochłonne i może zostać przerwane z powodu różnych błędów.

\begin{enumerate}
    \item Jeżeli dany utwór ma już dopasowane nagranie (video\_id) i jest ono zewaluowane to nic nie rób
    \item Jeżeli dany utwór ma już dopasowane \emph{video\_id} i NIE jest ono zewaluowane to zrób
        ewaluację tego nagrania
    \item todo
\end{enumerate}

\subsubsection{Selekcja utworów, dla których znaleziono dobre nagranie}


% - zorganizować zbiór danych nieoznaczonych
% 
% - wstępne przetwarzanie danych - format danych wejściowy i wyjściowy (wejściowy do sieci)
%     - format i parsowanie plików z oznaczeniami i plików muzycznych
%     - podział na ramki i dopasowanie labelek do ramek
%     - augmentacja
